# Extend a Neuron runtime base image passed at build time.
ARG BASE_IMAGE
FROM ${BASE_IMAGE}

# Ensure build tooling is up to date.
RUN pip install --no-cache-dir --upgrade pip setuptools wheel

# Workspace for your PR code.
WORKDIR /workspace

# Copy the entire repo (CodeBuild passes the PR source as build context).
COPY . /workspace/src

# Remove any vLLM baked into the base image (ignore error if none present).
RUN pip uninstall -y vllm || true

# Install THIS commit's vLLM (and any other project packages).
WORKDIR /workspace/src
RUN pip install --no-cache-dir -e .

# Placeholder default command (Kaizen can override --command).
CMD ["python", "examples/offline_inference/neuron.py"]
